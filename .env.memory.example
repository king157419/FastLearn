# DeepTutor Memory System - 环境配置

# ============================================
# PostgreSQL + pgvector 配置
# ============================================

# 数据库连接信息
DATABASE_URL=postgresql://deeptutor:deeptutor_password@localhost:5433/deeptutor_memory
POSTGRES_HOST=localhost
POSTGRES_PORT=5433
POSTGRES_USER=deeptutor
POSTGRES_PASSWORD=deeptutor_password
POSTGRES_DB=deeptutor_memory

# 连接池配置
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# ============================================
# Embedding 模型配置
# ============================================

# 选项 1: OpenAI Embeddings（推荐，质量最好）
EMBEDDING_PROVIDER=openai
EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_DIMENSIONS=1536
OPENAI_API_KEY=sk-your-key-here
OPENAI_EMBEDDING_BASE_URL=https://api.openai.com/v1

# 选项 2: DeepSeek Embeddings（成本低，中文友好）
# EMBEDDING_PROVIDER=deepseek
# EMBEDDING_MODEL=deepseek-embeddings
# EMBEDDING_DIMENSIONS=1024
# DEEPSEEK_API_KEY=sk-your-key-here
# DEEPSEEK_BASE_URL=https://api.deepseek.com/v1

# 选项 3: Jina Embeddings（开源，可本地部署）
# EMBEDDING_PROVIDER=jina
# EMBEDDING_MODEL=jina-embeddings-v2
# EMBEDDING_DIMENSIONS=768
# JINA_API_KEY=your-key-here

# ============================================
# 向量数据库配置
# ============================================

# 向量索引类型（ivfflat 或 hnsw）
VECTOR_INDEX_TYPE=ivfflat

# IVFFlit 参数
IVFFLAT_LISTS=100

# HNSW 参数（如果使用 HNSW）
# HNSW_M=16
# HNSW_EF_CONSTRUCTION=64

# ============================================
# 摘要 Agent 配置
# ============================================

# 摘要触发条件
SUMMARY_TRIGGER_ROUNDS=10        # 对话轮次
SUMMARY_TRIGGER_TOKENS=4000      # Token 数量

# 摘要保留消息数
SUMMARY_KEEP_RECENT=5           # 保留最近 N 条完整消息

# ============================================
# 检索配置
# ============================================

# 检索 Top-K
MEMORY_RETRIEVAL_TOP_K=10        # 关键词检索返回数
SEMANTIC_RETRIEVAL_TOP_K=10      # 语义检索返回数
HYBRID_RETRIEVAL_TOP_K=7         # 混合检索最终返回数

# 时间过滤
MEMORY_TIME_FILTER_DAYS=7       # 只检索最近 N 天的记忆

# 重排序权重
RERANK_KEYWORD_WEIGHT=0.4        # 关键词匹配权重
RERANK_SEMANTIC_WEIGHT=0.4       # 语义相似度权重
RERANK_PROFILE_WEIGHT=0.2        # 用户画像匹配权重

# ============================================
# 缓存配置
# ============================================

# Redis 缓存（可选）
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
CACHE_TTL=3600                  # 缓存过期时间（秒）

# ============================================
# 日志配置
# ============================================

LOG_LEVEL=INFO                   # DEBUG | INFO | WARNING | ERROR
LOG_FILE=logs/memory_system.log

# ============================================
# 其他配置
# ============================================

# 环境标识
ENVIRONMENT=development          # development | production

# API 配置
API_HOST=0.0.0.0
API_PORT=8001
API_WORKERS=4

# CORS 配置
CORS_ORIGINS=http://localhost:3000,http://localhost:8000
